================================================================================
REBUILD TODO LIST
================================================================================

IMPORTANT RULES:
- This file MUST be kept up to date
- ALL todos go in this doc, NOT in code comments
- Keep todos CONCISE - brief actionable items only
- Update this file as work progresses
- Completed todos should be REMOVED from this file (keep file clean)

================================================================================
CRITICAL - Blocking Functionality
================================================================================

[ ] Ensure all build artifacts go to build/ directory
    - Object files: build/*.o
    - Dependency files: build/*.d
    - Final binary: build/rebuild (NOT in source tree)
    - Bootstrap should create: build/rebuild (not bootstrap/rebuild)
    - Update bootstrap Makefile to output to ../build/ not ./rebuild

================================================================================
Core Features
================================================================================

[ ] Fix glob patterns implementation (90% COMPLETE - type metadata issue)
    - Single-star: src/*.c (one directory level) - C implementation DONE
    - Double-star: src/**/*.c (recursive) - not implemented
    - STATUS: Glob finds files correctly (13 matches), allocates arrays properly
    - ISSUE: UMKA rejects array with "Illegal block size" error
    - Root cause: Type metadata structure not fully matching UMKA expectations
    - Next: Debug UmkaType structure layout or use alternative approach
    - Location: src/umka_bridge.c:522-584

[ ] Add directory tree dependencies
    - New API: rebuild_depend_on_tree(path: str): str
    - Implement recursive directory hashing
    - Update trace system for directory tracking
    - Add FFI function to umka_bridge.c

[ ] Test tool system verification
    - Verify tools/clang.um works with real builds
    - Verify tools/ar.um works
    - Test depfile parsing and registration
    - Test tool binary hash invalidation
    - Test tool module hash invalidation

================================================================================
Self-Hosting
================================================================================

[ ] Enhance BUILD.um for self-hosting
    - Add vendor dependency targets (libuv, umka, blake2)
    - Add rebuild binary target
    - Test: bootstrap/rebuild rebuild â†’ build/rebuild

[ ] Three-builds verification test
    - Build 1: make -C bootstrap â†’ bootstrap/rebuild
    - Build 2: bootstrap/rebuild rebuild â†’ build/rebuild
    - Build 3: build/rebuild rebuild â†’ build/rebuild2
    - Verify: build/rebuild and build/rebuild2 are bit-identical

[ ] Document bootstrap and self-hosting process
    - Create doc/bootstrap.txt
    - Explain bootstrap
    - Explain three-builds test
    - Document expected behavior

[ ] Remove root-level Makefile
    - All builds should use bootstrap/Makefile or rebuild
    - Clean up legacy build infrastructure
    - Update documentation to reflect bootstrap-first approach

================================================================================
Testing & Verification
================================================================================

[ ] Integration tests (test/workspace/)
    - Ensure sys() tests pass (blocked by array fix)
    - Add glob pattern tests
    - Add directory tree dependency tests
    - Test cache invalidation scenarios
    - Test parallel builds

[ ] Verbose build logging
    - Add --verbose flag to rebuild
    - Log all FFI calls
    - Log trace validation steps
    - Log dependency resolution

[ ] Build trace introspection
    - Add command: rebuild trace <target>
    - Show full dependency chain
    - Show why target was rebuilt
    - Show cached vs rebuilt status
    - Display hash values for deps

[ ] Test trace system thoroughly
    - Cache hits with unchanged deps
    - Cache misses with changed deps
    - Early cutoff optimization
    - Trace persistence across runs

================================================================================
Documentation
================================================================================

[ ] Create doc/user-guide.txt
    - Writing BUILD.um files
    - Target registration
    - Using FFI functions
    - Tool API usage
    - All FFI functions documented
    - Parameters and return types
    - Usage examples
    - Error handling

[ ] Create doc/architecture.txt
    - System architecture overview
    - Component interaction
    - Data flow diagrams

[ ] Create README.md
    - Project overview
    - Quick build instructions
    - Link to user guide
    - Getting started guide
    - First build instructions
    - Basic BUILD.um examples

================================================================================
Future Enhancements
================================================================================

[ ] Replace vendor dependency build systems with rebuild
    - Convert libuv, UMKA, blake2 to use BUILD.um files
    - Remove autotools/make dependencies from vendor libs
    - Full hermetic builds with rebuild

[ ] HTTPS tarball download with content hash
    - Add rebuild_download(url: str, hash: str): str API
    - Support for downloading binaries/tools with hash verification
    - Support for downloading source directories with hash verification
    - Enable reproducible builds with external dependencies

[ ] Full cross-compilation support
    - Add target architecture flags (x86_64, arm64, etc.)
    - Add target OS flags (linux, darwin, windows, etc.)
    - Add target environment/ABI flags
    - Pass target triple to tools
    - Support cross-compiling the rebuild binary itself

[ ] Remote caching support
[ ] Build profiling
[ ] Watch mode for continuous builds
[ ] Parallel trace validation
[ ] Speculative execution
[ ] Cache size management and GC
[ ] Additional tool APIs (python, cmake, pkg_config, protobuf)

================================================================================
Current Blockers
================================================================================

âœ“ sys() array passing broken - FIXED
âœ“ Bootstrap build untested - TESTED AND WORKING
ðŸŸ¡ Self-hosting not verified
ðŸŸ¡ Glob patterns 90% complete (type metadata issue remaining)
ðŸŸ¡ Directory tree dependencies not implemented

================================================================================
Success Criteria
================================================================================

âœ“ Vendor dependencies copied and building
âœ“ Bootstrap Makefile created
âœ“ Build artifacts organized in build/
âœ“ Bootstrap build works from clean checkout
âœ“ sys() executes commands correctly
- Glob patterns work (*.c, **/*.h)
- Self-hosting: build â†’ rebuild â†’ rebuild â†’ identical binaries
- Integration tests pass
- Trace introspection working
- Verbose logging functional
- Basic documentation complete

================================================================================
